- name: Publicar Modulo
        shell: pwsh
        env:
          PSG_KEY: ${{ secrets.PSGALLERY_API_KEY }}
        run: |
          $ErrorActionPreference = "Stop"
          
          # 1. Garante protocolos de seguranÃ§a modernos
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12

          # 2. Atualiza os mÃ³dulos de gerenciamento de pacotes (RecomendaÃ§Ã£o)
          Write-Host "ðŸ”„ Atualizando ferramentas de gerenciamento..."
          Install-Module -Name PowerShellGet -Force -SkipPublisherCheck -Scope CurrentUser
          Install-Module -Name PackageManagement -Force -SkipPublisherCheck -Scope CurrentUser
          Import-Module PackageManagement

          # 3. Agora sim, instala o NuGet com a base atualizada
          Write-Host "ðŸ“¦ Instalando provedor NuGet..."
          Install-PackageProvider -Name NuGet -MinimumVersion 2.8.5.201 -Force -Confirm:$false

          # 4. Configura e pÃºblica
          Set-PSRepository -Name PSGallery -InstallationPolicy Trusted
          $modulePath = Resolve-Path "./src/PoshAutomator"
          
          Write-Host "ðŸš€ Publicando versÃ£o oficial na PowerShell Gallery..."
          Publish-Module -Path $modulePath -NuGetApiKey $env:PSG_KEY -Verbose -Force