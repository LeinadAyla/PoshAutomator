name: Deploy PoshAutomator
on:
  push:
    branches: [ main ]

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout do c√≥digo
        uses: actions/checkout@v4

      - name: Publicar Modulo
        shell: pwsh
        env:
          PSG_KEY: ${{ secrets.PSGALLERY_API_KEY }}
        run: |
          $ErrorActionPreference = "Stop"
          
          # Debug: Mostra onde o rob√¥ est√° e o que ele v√™
          Write-Host "--- Verificando Conte√∫do do Repo ---"
          Get-ChildItem -Recurse

          $modulePath = "./src/PoshAutomator"

          # Configura√ß√µes de ambiente para o Linux
          Install-PackageProvider -Name NuGet -MinimumVersion 2.8.5.201 -Force
          Set-PSRepository -Name PSGallery -InstallationPolicy Trusted

          # Publica√ß√£o
          Write-Host "üöÄ Publicando vers√£o 1.0.1..."
          Publish-Module -Path $modulePath -NuGetApiKey $env:PSG_KEY -Verbose -Force